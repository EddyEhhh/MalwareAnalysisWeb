/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.organisation.entity;

import edu.mac.malwarereport.organisation.dto.OrganisationDTO;
import jakarta.persistence.CascadeType;
import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.JoinColumn;
import jakarta.persistence.NamedQueries;
import jakarta.persistence.NamedQuery;
import jakarta.persistence.OneToOne;
import jakarta.persistence.PrePersist;
import jakarta.persistence.Table;
import jakarta.validation.constraints.NotBlank;
import java.util.UUID;

/**
 *
 * @author tohyu
 */
@Entity
@Table(name="organisation")
@NamedQueries({
    @NamedQuery(name = "Organisation.bySuuid", query = "select r from Organisation r where r.suuid = :suuid")
})
public class Organisation {
    
    @Id
    @Column(name="id")
    @GeneratedValue(strategy=GenerationType.AUTO)
    private long id;
    
    @NotBlank
    @Column(name="name")
    private String name;
    
    @Column(name="description")
    private String description;
    
    @Column(name="suuid", unique = true)
    private String suuid;
    
    @OneToOne(fetch = FetchType.EAGER, cascade=CascadeType.ALL)
    @JoinColumn(referencedColumnName = "id", name="setting")
    private Setting setting;
    
    public Organisation(){}
    
    public Organisation(String name, String description, Setting setting)
    {
        this.name = name;
        this.description = description;
        this.setting = setting;
    }
    
//     public Organisation(String name, String description, String suuid, Setting setting){
//        this.name = name;
//        this.description = description;
//        this.suuid = suuid;
//        this.setting = setting;
//    }
     
    @PrePersist
    public void onCreate(){
        //random generate the uuid
        this.suuid = UUID.randomUUID().toString();
        this.setting.setMaxLoginAttempt(5);
        this.setting.setLockoutTimeInMinute(20);
    }
    
    public OrganisationDTO toDTO(){
        OrganisationDTO organisationDTO = new OrganisationDTO(this.suuid, this.name, this.description, this.setting.toDTO());
        return organisationDTO;
    }
    
    
    /**
     * @return the id
     */
    public long getId() {
        return id;
    }

    /**
     * @param id the id to set
     */
    public void setId(long id) {
        this.id = id;
    }

    /**
     * @return the name
     */
    public String getName() {
        return name;
    }

    /**
     * @param name the name to set
     */
    public void setName(String name) {
        this.name = name;
    }

    /**
     * @return the description
     */
    public String getDescription() {
        return description;
    }

    /**
     * @param description the description to set
     */
    public void setDescription(String description) {
        this.description = description;
    }
    
    
    /**
     * @return the suuid
     */
    public String getSuuid() {
        return suuid;
    }

    /**
     * @param suuid the suuid to set
     */
    public void setSuuid(String suuid) {
        this.suuid = suuid;
    }
        /**
     * @return the setting
     */
    public Setting getSetting() {
        return setting;
    }

    /**
     * @param setting the setting to set
     */
    public void setSetting(Setting setting) {
        this.setting = setting;
    }
}
