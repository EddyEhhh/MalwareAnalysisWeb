<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xml:lang="en">

    <ui:composition template="/template/user_default.xhtml">
        <ui:define name="pageTitle">#{msg['header.report']}</ui:define>
        <ui:define name="body">
            <h:body>
                <br/>
                <h:form id="reportForm">
                    <p:dataTable id="reports" var="thisSample" widgetVar="dtReports" value="#{viewOrganisationReportBean.samples}" rowKey="#{thisSample.suuid}"
                                emptyMessage="No Report Found with the Given Criteria"
                                filteredValue="#{viewOrganisationReportBean.filteredReports}"
                                globalFilterFunction="#{viewOrganisationReportBean.globalFilterFunction}"
                                rows="10"
                                paginator="true"
                                paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                                rowsPerPageTemplate="5,10,{ShowAll|'All'}"
                                draggableColumns="true"
                                resizableColumns="true">
                        <f:facet name="header">
                            <div class="products-table-header grid">
                                <div class="col-8">
                                <span class="font-bold text-3xl">#{msg['report.capitalise']}</span>
                                </div>
                                <div class="col-1">
                                    <p:commandButton id="toggler" type="button" value="#{msg['report.filter']}" class="mx-4 ui-button-raised ui-button-help" icon="pi pi-align-justify"/>
                                    <p:columnToggler datasource="reports" trigger="toggler"/>
                                </div>
                                <div class="col-3">
                                    <div class="p-d-flex p-jc-end">
                                        <p:inputText id="globalFilter" class="shadow-2" onkeyup="PF('dtReports').filter()" style="width:350px"
                                        placeholder="Search" />
                                    </div>
                                </div>

                            </div>
                        </f:facet>
                        <p:column class="text-lg" headerText="#{msg['report.sampleName']}" sortBy="#{thisSample.reportValueDTO.sampleName}">
                            <h:outputText value="#{thisSample.reportValueDTO.sampleName}" />
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.analysisStartTime']}" sortBy="#{thisSample.analysisStartTime}">
                            <h:outputText value="#{thisSample.analysisStartTime}"/>
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.analysisEnvironment']}" sortBy="#{thisSample.analysisEnvironment}">
                            <h:outputText value="#{thisSample.analysisEnvironment}"/>
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.threatScore']}" sortBy="#{thisSample.reportValueDTO.threatScore}">
                            <h:outputText value="#{thisSample.reportValueDTO.threatScore} / 5" />
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.sha256hash']}" sortBy="#{thisSample.reportValueDTO.hashSHA256}">
                            <h:outputText value="#{thisSample.reportValueDTO.hashSHA256}" />
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.sha1hash']}" sortBy="#{thisSample.reportValueDTO.hashSHA1}">
                            <h:outputText value="#{thisSample.reportValueDTO.hashSHA1}" />
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.md5hash']}" sortBy="#{thisSample.reportValueDTO.hashMD5}">
                            <h:outputText value="#{thisSample.reportValueDTO.hashMD5}" />
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.status']}" sortBy="#{thisSample.reportValueDTO.hashMD5}">
                            <p:tag styleClass="p-mr-3" severity="#{viewOrganisationReportBean.getStatus(thisSample.status)[0]}" value="#{viewOrganisationReportBean.getStatus(thisSample.status)[1]}" rounded="true"></p:tag>
                        </p:column>
                        <p:column class="text-lg" headerText="#{msg['report.action']}">
                            <p:commandButton rendered="#{uIPermission.viewReportDetail and thisSample.status.toLowerCase()=='done' ? true : false}" id="viewReport" icon="pi pi-search" action="#{redirectBean.viewReport()}" class="rounded-button ui-button-info ui-button-flat">
                                    <f:param name="id" value="#{thisSample.suuid}"/>
                                    <p:tooltip for="viewReport" value="#{msg['report.viewReport']}" position="bottom"/>
                            </p:commandButton>
                            <p:commandButton rendered="#{uIPermission.viewHeuristicReport and thisSample.status.toLowerCase()=='done' ? true : false}" id="viewPDF" icon="pi pi-file-pdf" action="#{redirectBean.viewPDF()}" class="rounded-button ui-button-success ui-button-flat">
                                    <f:param name="id" value="#{thisSample.suuid}"/>
                                    <p:tooltip for="viewPDF" value="#{msg['report.viewPDF']}" position="bottom"/>
                            </p:commandButton>
                        </p:column> 
                    </p:dataTable>
                    
<!--                    <p:blockUI block="reports" trigger="reports">
                        <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
                    </p:blockUI>-->
                </h:form> 
            </h:body>
        </ui:define>
    </ui:composition>
</html>