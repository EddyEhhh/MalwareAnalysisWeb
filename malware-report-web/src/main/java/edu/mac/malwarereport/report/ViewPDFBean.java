/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.report;

import edu.mac.malwarereport.report.applicationFacade.ViewPDFApplicationFacade;
import edu.mac.malwarereport.report.dto.SampleDTO;
import edu.mac.malwarereport.report.manager.SampleManager;
import edu.mac.malwarereport.report.manager.ViewPDFManager;
import jakarta.annotation.PostConstruct;
import jakarta.faces.context.FacesContext;
import jakarta.faces.view.ViewScoped;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import jakarta.servlet.http.HttpServletRequest;
import java.io.Serializable;

/**
 *
 * @author tohyu
 */
@Named("viewPDFBean")
@ViewScoped
public class ViewPDFBean implements Serializable {

    private String filepath;

    private SampleDTO selectedSample;

    @Inject
    private ViewPDFManager viewPDFManager;

    @Inject
    private SampleManager sampleManager;
    
    @Inject
    private ViewPDFApplicationFacade viewPDFApplicationFacade;

    @PostConstruct
    public void init() {
        HttpServletRequest req = (HttpServletRequest) FacesContext.getCurrentInstance().getExternalContext().getRequest();
        //this is to request the 'id' which is the variable at the end on the url 
        String uuid = req.getParameter("id");
        //find the report by the 'id'
        SampleDTO sampleDTO = new SampleDTO();
        sampleDTO.setSuuid(uuid);
        selectedSample = sampleManager.findByUuid(sampleDTO);
        String sampleName = selectedSample.getReportValueDTO().getSampleName();
        String suuid = selectedSample.getSuuid();

        //retrieve the file
        getPDF(suuid, sampleName);
        System.out.print(filepath);
    }

    private void getPDF(String suuid, String sampleName) {
        SampleDTO pdfSampleDTO = new SampleDTO();
        pdfSampleDTO.setSuuid(suuid);
        pdfSampleDTO.getReportValueDTO().setSampleName(sampleName);
        System.out.print(pdfSampleDTO);
        filepath = "/resources/files/" + viewPDFApplicationFacade.getPDF(pdfSampleDTO);
    }

    /**
     * @return the filepath
     */
    public String getFilepath() {
        return filepath;
    }

    /**
     * @param filepath the filepath to set
     */
    public void setFilepath(String filepath) {
        this.filepath = filepath;
    }

    /**
     * @return the selectedReport
     */
    public SampleDTO getSelectedSample() {
        return selectedSample;
    }

    /**
     * @param selectedReport the selectedReport to set
     */
    public void setSelectedSample(SampleDTO selectedSample) {
        this.selectedSample = selectedSample;
    }

}
