/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.account;

import edu.mac.malwarereport.account.applicationFacade.PasswordApplicationFacade;
import edu.mac.malwarereport.account.dto.AccountDTO;
import static edu.mac.malwarereport.account.outputInfo.OutcomeStatus.FAILURE;
import static edu.mac.malwarereport.account.outputInfo.OutcomeStatus.SUCCESS;
import static edu.mac.malwarereport.account.outputInfo.ResetPasswordStatus.TIMEOUT;
import edu.mac.malwarereport.account.web.RedirectBean;
import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.context.FacesContext;
import jakarta.faces.context.Flash;
import jakarta.inject.Inject;
import jakarta.inject.Named;

/**
 *
 * @author Jaibun Thana
 */

@RequestScoped
@Named("passwordBean")
public class PasswordBean {
    
    //Object
    private AccountDTO accountDTO = new AccountDTO();
    
    @Inject
    private PasswordApplicationFacade passwordApplicationFacade;
    
    @Inject
    private FacesContext facesContext;
        
    public void changePassword() {
        if (accountDTO.confirmPassword()) {
            switch (passwordApplicationFacade.changePassword(accountDTO)) {
                case "SUCCESS":
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Successfully changed password", null));
                    break;
                case "INVALID_PASSWORD":
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Invalid Password", null));
                    break;
                default:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Oops something went wrong!", null));
                    break;
            }
        }
    }
    @Inject
    private RedirectBean redirectBean;
    
    public void resetPassword() throws Exception{
        if (accountDTO.confirmPassword()) {
            facesContext = FacesContext.getCurrentInstance();
            Flash flash = facesContext.getExternalContext().getFlash();
            flash.setKeepMessages(true);
            switch (passwordApplicationFacade.resetPassword(accountDTO)) {
                case SUCCESS:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Successfully reset password", null));
                    redirectBean.login();
                    break;
                case FAILURE:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Oops something went wrong!", null));
                    break;
                case TIMEOUT:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Timed out, please check email.", null));
                    break;
                default:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Oops something went wrong!", null));
                    break;
            }
        }
    }
    
    public void forgetPassword(){
        switch(passwordApplicationFacade.createResetPasswordToken(accountDTO)){
                case SUCCESS:
                case FAILURE:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Please check your email.", null));
                    break;
                default:
                    facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Oops something went wrong!", null));
                    break;
        }
    }
    

    
    //SETTERS GETTERS
    public AccountDTO getAccountDTO() {
        return accountDTO;
    }

    public void setAccountDTO(AccountDTO accountDTO) {
        this.accountDTO = accountDTO;
    }

    
    
    
}
