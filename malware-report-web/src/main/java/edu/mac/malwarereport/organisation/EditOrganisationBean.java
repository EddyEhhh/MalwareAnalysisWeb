/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.organisation;

import static edu.mac.malwarereport.account.outputInfo.OutcomeStatus.ERROR;
import static edu.mac.malwarereport.account.outputInfo.OutcomeStatus.SUCCESS;
import edu.mac.malwarereport.account.web.RedirectBean;
import edu.mac.malwarereport.organisation.applicationFacade.OrganisationApplicationFacade;
import edu.mac.malwarereport.organisation.dto.OrganisationDTO;
import jakarta.annotation.PostConstruct;
import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.context.ExternalContext;
import jakarta.faces.context.FacesContext;
import jakarta.faces.context.Flash;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import jakarta.servlet.http.HttpServletRequest;

/**
 *
 * @author tohyu
 */
@Named("editOrganisationBean")
@RequestScoped
public class EditOrganisationBean {
    
    @Inject
    private OrganisationApplicationFacade organisationApplicationFacade;
    
    private OrganisationDTO selectedOrganisation = new OrganisationDTO();
    
    @Inject
    private RedirectBean redirectBean;
    
    @Inject
    private FacesContext facesContext; 
    
    private ExternalContext externalContext = FacesContext.getCurrentInstance().getExternalContext();

    private HttpServletRequest req = (HttpServletRequest)externalContext.getRequest();

    
    @PostConstruct
    public void init() {
        try {
            if(!req.getParameter("id").isBlank()){
                String uid = req.getParameter("id");
                selectedOrganisation = organisationApplicationFacade.findBySuuid(uid);
            }
            
        } catch (Exception e) {
            System.out.print("got error");
        }
//    }
    }
    
    public void updateOrganisation() throws Exception{
        String uid = selectedOrganisation.getSuuid();
        System.out.print(uid);
        facesContext = FacesContext.getCurrentInstance();
        Flash flash = facesContext.getExternalContext().getFlash();
        flash.setKeepMessages(true);
         switch(organisationApplicationFacade.updateOrganisation(selectedOrganisation)){
             case SUCCESS:
                facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Details updated successfully", null));
                redirectBean.viewOrganisationAdmin(uid);
                break;
            case ERROR:
            default:
                facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_ERROR, "Oops something went wrong!", null));
                break;
         }
        
    }
    
    /**
     * @return the selectedOrganisation
     */
    public OrganisationDTO getSelectedOrganisation() {
        return selectedOrganisation;
    }

    /**
     * @param selectedOrganisation the selectedOrganisation to set
     */
    public void setSelectedOrganisation(OrganisationDTO selectedOrganisation) {
        this.selectedOrganisation = selectedOrganisation;
    }
    
}
