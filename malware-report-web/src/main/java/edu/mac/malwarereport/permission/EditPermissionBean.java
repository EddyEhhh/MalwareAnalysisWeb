/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.permission;

import edu.mac.malwarereport.account.web.RedirectBean;
import edu.mac.malwarereport.permission.applicationFacade.PermissionApplicationFacade;
import edu.mac.malwarereport.permission.dto.PermissionDTO;
import jakarta.annotation.PostConstruct;
import jakarta.enterprise.context.RequestScoped;
import jakarta.faces.application.FacesMessage;
import jakarta.faces.context.FacesContext;
import jakarta.faces.context.Flash;
import jakarta.inject.Inject;
import jakarta.inject.Named;
import jakarta.servlet.http.HttpServletRequest;

/**
 *
 * @author tohyu
 */
@Named("editPermission")
@RequestScoped
public class EditPermissionBean {
    
    @Inject
    private PermissionApplicationFacade permissionApplicationFacade;
    
    private PermissionDTO selectedPermission = new PermissionDTO();
    
    @Inject
    private FacesContext facesContext; 
    
    @Inject
    private RedirectBean redirectBean;

    private HttpServletRequest req = (HttpServletRequest)facesContext.getCurrentInstance().getExternalContext().getRequest();
    
    @PostConstruct
    public void init() {
        try{
            if(!req.getParameter("id").isBlank()){
                String uid = req.getParameter("id");
                selectedPermission = permissionApplicationFacade.findBySuuid(uid);
            }
        }
         catch (Exception e){
             System.out.println("got error");
         }
    }
    
    public void updatePermission() throws Exception{
        facesContext = FacesContext.getCurrentInstance();
        Flash flash = facesContext.getExternalContext().getFlash();
        flash.setKeepMessages(true);
        permissionApplicationFacade.update(getSelectedPermission());
        facesContext.addMessage(null, new FacesMessage(FacesMessage.SEVERITY_INFO, "Update Successfully", null));
        redirectBean.viewPermissionDetailArgs(selectedPermission.getSuuid());
    }
     /**
     * @return the selectedPermission
     */
    public PermissionDTO getSelectedPermission() {
        return selectedPermission;
    }

    /**
     * @param selectedPermission the selectedPermission to set
     */
    public void setSelectedPermission(PermissionDTO selectedPermission) {
        this.selectedPermission = selectedPermission;
    }
    
}
