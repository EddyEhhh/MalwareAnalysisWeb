/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.account.manager;

import edu.mac.malwarereport.account.entity.Account;
import edu.mac.malwarereport.account.resource.MailUtil;
import jakarta.ejb.Stateless;
import jakarta.inject.Inject;
import jakarta.inject.Named;

/**
 *
 * @author Jaibun Thana
 */
@Stateless
@Named("mailerManager")
public class MailerManager {
    
    @Inject
    private MailUtil mailUtil;
    
    public void emailVerification(Account account) throws Exception{
        String emailVerificationToken = account.getEmailVerification().getToken();
        String email = account.getEmail();
        String fullName = account.getFullName();
        String mailMessage = "Hi " + fullName +",\n"
                        + "To verify your Sandcastle account please verify that this email belongs to you.\n" + 
                        "http://sandcastle-analysis.duckdns.org:8080/malware-report-web/emailVerification.xhtml?id=" + emailVerificationToken + "\n" +
                        "Link will expire in 3 days.\n" + 
                        "Please ignore this email if you did not create an account.";
                mailUtil.sendMail(email, "Account Verification", mailMessage);
    }
    
    public void createResetPasswordToken(Account account) throws Exception{
        String email = account.getEmail();
        String fullName = account.getFullName();
        String token = account.getPasswordToken().getToken();
        String emailMessage = "Hi " + fullName + ",\n" +
                "This is the link to reset your Sandcastle password:\n"+
                "http://sandcastle-analysis.duckdns.org:8080/malware-report-web/resetPassword.xhtml?id=" + token + "\n";
        mailUtil.sendMail(email, "Reset Password", emailMessage);
    }
    
    public void newAccountPassword(Account account) throws Exception{
        String email = account.getEmail();
        String fullName = account.getFullName();
        String token = account.getPasswordToken().getToken();
        String emailMessage = "Hi " + fullName + ",\n" +
                "This is the link to activate your Sandcastle password:\n"+
                "http://sandcastle-analysis.duckdns.org:8080/malware-report-web/newAccount.xhtml?id=" + token + "\n" +
                "Link expires in 3 days";
        mailUtil.sendMail(email, "Reset Password", emailMessage);
    }
    
    public void bruteForceWarning(Account account, String timeout) throws Exception{
        String email = account.getEmail();
        String fullName = account.getFullName();
        String emailMessage = "Hi " + fullName + ",\n" +
                "Your sandcastle account has been locked out for " +
                timeout + 
                "minute after too many login attempts.\n";
        mailUtil.sendMail(email, "Security warning", emailMessage);
    }
    
}
