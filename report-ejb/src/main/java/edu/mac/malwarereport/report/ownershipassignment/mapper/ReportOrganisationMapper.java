/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package edu.mac.malwarereport.report.ownershipassignment.mapper;

import edu.mac.malwarereport.organisation.manager.OrganisationManager;
import edu.mac.malwarereport.ownership.outputinfo.MappingStatus;
import edu.mac.malwarereport.personnel.entity.OwnershipAssignment;
import edu.mac.malwarereport.personnel.manager.OwnershipAssignmentManager;
import jakarta.ejb.Stateless;
import jakarta.inject.Inject;
import java.util.List;

/**
 *
 * @author Jaibun Thana
 */
@Stateless
public class ReportOrganisationMapper {
    
    @Inject
    private OwnershipAssignmentManager ownershipAssignmentManager;
    
    @Inject
    private OrganisationManager organisationManager;
    
    public OwnershipAssignment getOwnershipAssignment(){
        String primaryType = "org";
        String secondaryType = "report";
        OwnershipAssignment organisationReportAssignment = new OwnershipAssignment(primaryType, secondaryType);
        return organisationReportAssignment;
    }
    
    public long getOrganisationId(String organisationSuuid){
        return organisationManager.getIdBySuuid(organisationSuuid);
    }
    
    public boolean isMappingExist(Long organisationId, Long reportId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        organisationReportAssignment.setPrimaryId(organisationId);
        organisationReportAssignment.setSecondaryId(reportId);
        return ownershipAssignmentManager.isMapped(organisationReportAssignment);
    }
    
    public MappingStatus createMapping(Long organisationId, Long sampleId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        try{
            organisationReportAssignment.setPrimaryId(organisationId);
            organisationReportAssignment.setSecondaryId(sampleId);
            return (ownershipAssignmentManager.create(organisationReportAssignment));
        }catch (Exception e){
            return MappingStatus.FAILURE;
        }
    }
    
    public List<Long> getSampleIdList(Long organisationId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        organisationReportAssignment.setPrimaryId(organisationId);
        return ownershipAssignmentManager.getAllSecondaryId(organisationReportAssignment);
    }
    
    public int countSample(Long organisationId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        organisationReportAssignment.setPrimaryId(organisationId);
        return ownershipAssignmentManager.countAllMappingByPrimaryId(organisationReportAssignment);
    }
    
    public long getOrganisationId(Long sampleId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        organisationReportAssignment.setSecondaryId(sampleId);
        return ownershipAssignmentManager.getPrimaryId(organisationReportAssignment);
    }
    
    public boolean deleteMappingBySampleId(Long sampleId){
        OwnershipAssignment organisationReportAssignment = getOwnershipAssignment();
        organisationReportAssignment.setSecondaryId(sampleId);
        return ownershipAssignmentManager.deleteBySecondary(organisationReportAssignment);
    }
    
//    public List<Long> getOrganisationIdList(Long organisationId){
//        organisationAccountAssignment.setPrimaryId(organisationId);
//        return ownershipAssignmentManager.getAllSecondaryId(organisationAccountAssignment);
//    }
    
//    public long getOrganisationId(Long accountId){
//        organisationAccountAssignment.setSecondaryId(accountId);
//        return ownershipAssignmentManager.getPrimaryId(organisationAccountAssignment);
//    }
    
//    public boolean isMapped(Long organisationId, Long accountId){
//        return ownershipAssignmentManager.isMapped(organisationId, organisationDiscriminator, accountId, accountDiscriminator);
//    }
    
    
}
